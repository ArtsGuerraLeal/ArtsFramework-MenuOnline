<!doctype html>
<html lang="en">

<head>

    <title>{% block title %} {{ menu_data.title }} {% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2, user-scalable=yes, shrink-to-fit=no" />
    <meta property="og:title" content="{{ menu_data.title }} " />
    <meta property="og:url" content="{{ "https://fastmarkets.net/p/" ~ menu_data.name  }}" />
    <meta property="og:description" content="{{ menu_data.description }}"/>
    <meta property="og:image:secure_url" content="{{ "https://fastmarkets.net/images/"~ menu_data.preview }}"/>
    <meta property="og:type" content="website" />

    {% block stylesheets %}
        <link href="{{ asset('fontawesome-free/css/all.min.css') }}" rel="stylesheet" type="text/css">
        <link href="{{ asset('css/main.css') }}" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Alata' rel='stylesheet'>
        <link rel="stylesheet" href="{{ asset('/css/image-zoom.css') }}" />
    {% endblock %}

</head>

<body class="bg-secondary">

<link itemprop="thumbnailUrl" href="{{ "https://fastmarkets.net/images/"~ menu_data.preview }}">
<span itemprop="thumbnail" itemscope itemtype="http://schema.org/ImageObject">
  <link itemprop="url" href="{{ "https://fastmarkets.net/images/"~ menu_data.preview }}">
</span>

<div class="app-main bg-secondary">

    <div class="app-main__outer">

        <div class="app-main__inner">
            <style>
                @media(min-height:640px) and (max-height:740px)
                {
                    .prod-img{
                        height:420px;
                        width:auto;
                        object-fit: scale-down;
                    }
                }
                @media(min-height:740px) and (max-height:845px)
                {
                    .prod-img{
                        height:435px;
                        width:auto;
                        object-fit: scale-down;
                    }
                }
                @media(min-height:846px) and (max-height:1200px)
                {
                    .prod-img{
                        height:990px;
                        width:auto;
                        object-fit: scale-down;
                    }
                }
                @media(min-height:1200px) and (max-height:2200px)
                {
                    .prod-img{
                        height:1990px;
                        width:auto;
                        object-fit: scale-down;
                    }
                }
                .styled-table {
                    border-collapse: collapse;
                    margin: 25px 0;
                    font-size: 0.9em;
                    font-family: sans-serif;
                    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
                }
                .whatsapp{
                    height:20px;
                    width: 20px;
                    border-radius: 50%;
                    box-shadow: 4px 4px 5px grey;
                }
                .infobadge{
                    height:28px;
                    width: 28px;
                }
                .phone{
                    height:30px;
                    width: 30px;
                    border-radius: 50%;
                    box-shadow: 4px 4px 5px grey;
                }
                table {
                    text-align: left;
                    position: relative;
                    border-collapse: collapse;
                }
                .styled-table thead tr {
                    background-color: #009879;
                    color: #ffffff;
                    text-align: left;
                }
                .styled-table th {
                    background-color: #009879;
                    position: sticky;
                    top: 0; /* Don't forget this, required for the stickiness */
                }
                .styled-table th,
                .styled-table td {
                    padding: 12px 15px;
                }
                .styled-table tbody tr {
                    border-bottom: 1px solid #dddddd;
                }
                .styled-table tbody tr:nth-of-type(even) {
                    background-color: #f3f3f3;
                }
                .styled-table tbody tr:last-of-type {
                    border-bottom: 2px solid #009879;
                }
                .styled-table tbody tr.active-row {
                    font-weight: bold;
                    color: #009879;
                }
                html, body {
                    overflow-x: hidden;
                }
                body {
                    overflow: hidden;
                    position: relative;
                    margin: 0;
                    padding: 0;
                }
                .add_product{
                    margin-top: 1rem;
                    margin-right: 1rem;
                    margin-bottom: 1rem;
                    margin-left: 0rem;
                    color: white;
                    font-size: 20px;
                    font-family: sans-serif;
                    /* This makes things *much* easier */
                    box-sizing: border-box;
                    position: absolute;
                    width: 120px;
                    height: 50px;
                }
            </style>

            <div class="main-card card">

                <div class="card-body"  >
                    <div id="card-area">
                        {% if menu_data.numOfImages <= 1 %}
                            <img class="prod-img d-block img-fluid rounded mx-auto my-3 border" src="{{ 'https://fastmarkets.s3.us-east-2.amazonaws.com/'~ menu_data.image ~ '_1.png' }}" />
                        {% endif %}
                        {% if menu_data.numOfImages > 1 %}
                            <div id="carouselExampleControls1" class="carousel slide" data-ride="carousel" data-interval="20000">

                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <div class="">
                                            <img class="prod-img d-block img-fluid mx-auto rounded my-3 border" src="{{ 'https://fastmarkets.s3.us-east-2.amazonaws.com/' ~ menu_data.image ~ '_1.png' }}" />
                                        </div>
                                    </div>


                                    {% for i in 2..menu_data.numOfImages  %}
                                        <div class="carousel-item">
                                            <div class="">
                                                <img class="prod-img d-block img-fluid mx-auto rounded my-3 border" src="{{ 'https://fastmarkets.s3.us-east-2.amazonaws.com/' ~ menu_data.image ~ '_'~ i ~'.png' }}" />
                                            </div>
                                        </div>
                                    {%endfor %}

                                </div>

                                <a class="carousel-control-prev"  href="#carouselExampleControls1" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next"  href="#carouselExampleControls1" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                    <div class="container">
                        <div class = "row">
                            <div class="col-sm text-center ">

                                {% if menu_data.notes is not null %}
                                    {{ menu_data.notes }}
                                {% endif %}
                                {% if menu_data.info is not null %}
                                    <a class="mx-2"  style="position: absolute" data-toggle="popover" data-html="true" data-placement="right" title="{{ menu_data.info }}" onclick="info()"><img class="infobadge" src="{{ asset('assets/images/info.png') }}"></a>
                                {% endif %}

                                <div class="mt-3">
                                    {% if menu_data.website is not null %}
                                        <button class="btn btn-primary border-dark" onclick="website()">Website</button>
                                    {% endif %}
                                     {% if menu_data.telephone is not null %}
                                    <button class="btn btn-secondary border-dark " onclick="call()">Llamar</button>
                                     {% endif %}
                                     {% if menu_data.whatsapp is not null %}
                                    <button class="btn btn-success border-dark" onclick="whatsapp()">Whatsapp</button>
                                     {% endif %}

                                </div>

                                <div>
                                    {% if menu_data.data is not null %}
                                        <table id="cart" class="products-cart styled-table my-2" style="overflow: scroll;height: 200px;display:block;" >
                                            <thead>
                                            <tr>
                                                <th>Producto</th>
                                                <th>Cantidad</th>
                                                <th></th>

                                            </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                      <p class="dataText" style="display: none" >{{ menu_data.data }}</p>

                                    {% endif %}
                                </div>


                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </div>
        <a class=" mt-3 my-1 btn-sm btn-warning border-dark text-center" style="font-family: 'Alata';font-size: 20px" role="button" onclick="promo()">Publícate Aquí!</a>

    </div>
</div>
</div>
</body>
{% block javascripts %}

    <script src="{{ asset('jquery/jquery-3.5.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/scripts/main.js') }}"></script>
    <script src="{{ asset('js/directive.js') }}"></script>


    <script>
        $(document).ready(function(data){
            visit();
        });
        function visit(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'visit',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
        }
        function website(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'website',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
            window.open('{{ menu_data.website }}');
        }
        function promo(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'promo',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
            window.open("https://fastmarkets.net");
        }
        function info(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'info',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
        }
        function call(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'phone',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
            window.open("tel:+"+{{ menu_data.telephone }});
        }
        function whatsapp(){
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'whatsapp',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
            var uri ='{{ menu_data.greeting }}\n';
            var uriText = encodeURI(uri);
            window.open("https://wa.me/"+{{ menu_data.whatsapp }} +"?text="+uriText);
        }
        function payment() {
            $.ajax({
                url:"{{ path('visit_counter') }}",
                type: "POST",
                data:{
                    visitData:'whatsapp',
                    name:'{{ menu_data.name }}'
                },
                success:function (php_result) {
                    console.log(php_result);
                }
            });
            var row_count = $('#cart tr').length;
            var uri ='{{ menu_data.greeting }}\n';
            $('#cart tr').each(function(index, tr) {
                if(index>0) {
                    console.log(index);
                    var row = $(tr).closest('tr');
                    var quantity = row.find('#quantity').text();
                    if(index < row_count-1){
                        uri += tr.id + " x " + quantity + '\n';
                    }else{
                        uri += tr.id + " x " + quantity;
                    }
                }
            });
            var uriText = encodeURI(uri);
            // console.log(uri)
            window.location.href = "https://wa.me/"+{{ menu_data.telephone }} +"?text="+uriText;
        }
        function loadButtons(){
            var elementText = document.getElementsByClassName('dataText');
            var jsonObj = JSON.parse(elementText);
            for(var i =0; i < getLength(jsonObj,'Button_');i++){
                var key = "Button_"+ i;
                var buttonElem = document.createElement('button');
                var buttonElemText = document.createTextNode(key);
                buttonElem.className = "btn btn-outline-secondary add_product";
                buttonElem.id = key;
                buttonElem.appendChild(buttonElemText);
                //  var button = $("<button class='btn btn-outline-secondary mybtn' id="+key+"></button>").text(i);
                document.getElementById("card-area").prepend(buttonElem);
            }
        }
        $(document).on('click', '.remove_all', function(){
            $(this).parent().parent().remove();
        });
        $(document).on('click', '.remove_product', function(){
            var quantity = $(this).parent().parent().children()[1].innerText;
            var prodPrice = parseFloat($(this).parent().parent().children()[2].innerText)/parseFloat(quantity);
            var prodID = $(this).parent().parent().attr('id');
            var i = $(this).parent().parent().index();
            var table = $(this).parent().parent().parent();
            if(quantity === "1"){
                $(this).parent().parent().remove();
            }else{
                $(this).parent().parent().children()[1].innerText = quantity - 1;
            }
        });
        $(document).on('click', '.add_product', function(){
            console.log("Hey");
            var cart = $('.products-cart');
            var prodName = $(this).attr('data-name');
            var prodID = $(this).attr('data-id');
            var prodAmount = 1;
            var cellVal = $(".products-cart tr td").filter(function() {
                return $(this).text() === prodName;
            });
            if(cellVal.text() === ""){
                cart.prepend('<tr class="active-row" id="'+prodName+'"><td >'+prodName+'</td><td id="quantity">1</td><td><div class="remove_product btn btn-danger btn-sm my-1 mx-1" style="position: initial;">Borrar</div><div class="remove_all btn btn-warning my-1 btn-sm" style="position: initial;">Vaciar</div></td></tr>');
            }else{
                var quantity = parseInt(cellVal.parent().children()[1].innerText);
                cellVal.parent().children()[1].innerText = quantity + 1;
            }
        });
        $( window ).on( "orientationchange", function( event ) {
            //  $( ".mybtn" ).remove();
            location.reload();
            //   DoStuff();
        });
        function DoStuff(){
            console.log("Added")
            var elementText = $('.dataText').text();
            var jsonObj = jQuery.parseJSON(elementText);
            var posX = 0;
            var posY = 0;
            var buttonWidth = 0;
            var buttonHeight = 0;
            var originalHeight = 968;
            var menuImage = $('#card-area').children('img');
            var scale = (100-(menuImage[0].clientWidth/originalHeight)*100);
            console.log(menuImage[0].clientWidth)
            var scaleMult = (1-(scale/100));
            console.log(scale);
            console.log(scaleMult);
            //console.log(570*(1-(scale/100)));
            for(var i =0; i < getLength(jsonObj,'Button_');i++){
                var key = "Button_"+ i;
                var button = $("<button class='btn border-dark btn-outline-success mybtn' id="+key+"></button>");
                $('#card-area').prepend(button);
                posX = jsonObj[key].xpos;
                posY = jsonObj[key].ypos;
                buttonWidth = jsonObj[key].width;
                buttonHeight = jsonObj[key].height;
                $('#'+key).css({"-webkit-transform":"translate("+posX*scaleMult+"px,"+posY*scaleMult+"px)"});
                $('#'+key).css({"width":buttonWidth*scaleMult});
                $('#'+key).css({"height":buttonHeight*scaleMult});
            }
        }
        $(document).ready(function(data){
            var elementText = $('.dataText').text();
            var jsonObj = jQuery.parseJSON(elementText);
            var posX = 0;
            var posY = 0;
            var buttonWidth = 0;
            var buttonHeight = 0;
            var originalHeight = 968;
            var menuImage = $('#card-area').children('img');
            var scale = (100-(menuImage[0].clientWidth/originalHeight)*100);
            var scaleMult = (1-(scale/100));
            console.log(scale);
            console.log(scaleMult);
            console.log(570*(1-(scale/100)));
            for(var i =0; i < getLength(jsonObj,'Button_');i++){
                var key = "Button_"+ i;
                var button = $("<button class='btn border-dark btn-outline-link add_product' id="+key+"></button>");
                $('#card-area').prepend(button);
                posX = jsonObj[key].xpos;
                posY = jsonObj[key].ypos;
                buttonWidth = jsonObj[key].width;
                buttonHeight = jsonObj[key].height;
                $('#'+key).css({"-webkit-transform":"translate("+posX*scaleMult+"px,"+posY*scaleMult+"px)"});
                $('#'+key).css({"width":buttonWidth*scaleMult});
                $('#'+key).css({"height":buttonHeight*scaleMult});
                $('#'+key).attr("data-name",jsonObj[key].itemname)
                $('#'+key).attr("data-id",key)
            }
        });
        function getLength(json,key){
            var jsonLength = 0;
            while(json[key+jsonLength]!== undefined){
                jsonLength++;
            }
            return jsonLength;
        }
    </script>
{% endblock %}
</html>